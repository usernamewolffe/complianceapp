{% load static %}
<dialog id="site-create-modal" class="c-modal" open aria-labelledby="site-create-title">
  <form
    id="site-create-form"
    method="post"
    hx-post="{% url 'orgs:site-create' org_id=org.id %}"
    hx-target="#org-sites-block"
    hx-swap="outerHTML"
    hx-disabled-elt="button"
    hx-on::after-request="if (event.detail.successful) this.closest('dialog')?.close();"
    style="max-width:820px;width:90vw"
  >
    {% csrf_token %}
    <div class="c-modal__header">
      <h3 id="site-create-title" class="c-modal__title">Add site</h3>
      <button type="button" class="c-modal__x" onclick="this.closest('dialog').close()">×</button>
    </div>

    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="grid" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="field">
        <label>Site name</label>
        {{ form.name }}
      </div>
      <div class="field">
        <label>Time zone</label>
        {{ form.timezone }}
      </div>

      <div class="field">
        <label>Essential service</label>
        {{ form.essential_service }}
      </div>
      <div class="field">
        <label>Network role</label>
        {{ form.network_role }}
      </div>

      <div class="field">
        <label>EIC code</label>
        {{ form.eic_code }}
      </div>
      <div></div>

      <div class="field" style="grid-column:1/-1">
        <label>Address line 1</label>
        {{ form.address_line1 }}
      </div>
      <div class="field" style="grid-column:1/-1">
        <label>Address line 2</label>
        {{ form.address_line2 }}
      </div>
      <div class="field">
        <label>Town/City</label>
        {{ form.city }}
      </div>
      <div class="field">
        <label>Postcode</label>
        {{ form.postcode }}
      </div>
      <div class="field">
        <label>Country (ISO-2)</label>
        {{ form.country_code }}
      </div>
      <div></div>

      <div class="field">
        <label>Primary contact – name</label>
        {{ form.contact_name }}
      </div>
      <div class="field">
        <label>Primary contact – role</label>
        {{ form.contact_role }}
      </div>
      <div class="field">
        <label>Primary contact – email</label>
        {{ form.contact_email }}
      </div>
      <div class="field">
        <label>Primary contact – phone</label>
        {{ form.contact_phone }}
      </div>

      <div class="field">
        <label>Out-of-hours phone</label>
        {{ form.ooh_phone }}
      </div>
      <div class="field">
        <label>DPO / privacy email</label>
        {{ form.dpo_email }}
      </div>
    </div>

    <div class="c-modal__footer">
      <button type="submit" class="btn btn-primary">Save site</button>
      <button type="button" class="btn" onclick="this.closest('dialog').close()">Cancel</button>
    </div>
  </form>

  <style>
    .c-modal { border: none; border-radius: 12px; padding: 0; }
    .c-modal::backdrop { background: rgba(0,0,0,.35); }
    .c-modal__header, .c-modal__footer { padding: 12px 16px; }
    .c-modal__header { display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #eee; }
    .c-modal__title { margin:0; font-size:1.1rem; }
    .c-modal__x { background:none; border:none; font-size:1.25rem; cursor:pointer; }
    .field label { display:block; font-size:.9rem; color:#555; margin-bottom:4px; }
    .field input, .field select { width:100%; padding:.5rem; border:1px solid #ced4da; border-radius:.5rem; }
    .c-modal__footer { display:flex; gap:.5rem; justify-content:flex-end; border-top:1px solid #eee; margin-top:12px; }
  </style>
  <script>
    // Remove the dialog from the DOM when it closes (keeps things tidy)
    (function(dlg){
      if (!dlg) return;
      dlg.addEventListener('close', () => dlg.remove());
    })(document.currentScript.closest('dialog'));
  </script>
</dialog>
